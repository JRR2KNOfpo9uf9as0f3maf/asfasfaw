local base64_chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'

local function base64_encode(data)
    return ((data:gsub('.', function(x)
        local r, b = '', x:byte()
        for i = 8, 1, -1 do r = r .. (b % 2 ^ i - b % 2 ^ (i - 1) > 0 and '1' or '0') end
        return r
    end) .. '0000'):gsub('%d%d%d?%d?%d?%d?', function(x)
        if (#x < 6) then return '' end
        local c = 0
        for i = 1, 6 do c = c + (x:sub(i, i) == '1' and 2 ^ (6 - i) or 0) end
        return base64_chars:sub(c + 1, c + 1)
    end) .. ({ '', '==', '=' })[#data % 3 + 1])
end

local function xor_encrypt(input, key)
    local output = {}
    for i = 1, #input do
        output[i] = string.char((input:byte(i) ~ key) % 256)
    end
    return table.concat(output)
end

local function obfuscate(file)
    local f = io.open(file, "r")
    if not f then
        print("File tidak ditemukan!")
        return
    end

    local code = f:read("*a") -- Baca kode asli
    f:close()

    local key = math.random(1, 255) -- Kunci XOR (acak setiap kali encrypt)
    local encrypted_code = xor_encrypt(code, key) -- XOR Enkripsi
    local encoded = base64_encode(encrypted_code) -- Base64 Encode

    -- Pastikan semua variabel ada sebelum format
    if not encoded or not key then
        print("Error: Encoding gagal!")
        return
    end

    -- Simpan ke file baru
    local output = "encrypted_" .. file
    local f_out = io.open(output, "w")

    -- Kode terenkripsi tanpa fungsi tambahan
    local encrypted_script = string.format([[
load((function()
    local b = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';
    local e = "%s";
    local k = %d;
    local d, r = {}, "";
    
    for i = 1, #b do d[b:sub(i, i)] = i - 1 end
    for i = 1, #e do
        local c = e:sub(i, i)
        r = r .. (d[c] and string.format('%06d', d[c]) or "")
    end

    local final_code = ""
    for i = 1, #r, 8 do
        local byte = tonumber(r:sub(i, i + 7), 2)
        final_code = final_code .. string.char((byte ~ k) %% 256)
    end

    return final_code
end)())]], encoded, key)

    f_out:write(encrypted_script)
    f_out:close()

    print("Obfuscation selesai! File disimpan sebagai: " .. output)
end

-- Masukkan nama file yang ingin dienkripsi
obfuscate("CRUS4DER DF 0.1.lua.txt")
ppek
